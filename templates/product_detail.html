{% extends "base.html" %}
{% block title %}{{ product.name }} - EcoFinds{% endblock %}
{% block head %}
<style>
    .product-container { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 60px; 
        background: var(--surface-dark); 
        padding: 50px; 
        border-radius: 25px;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-heavy);
        margin: 30px auto;
        max-width: 1400px;
        position: relative;
        overflow: hidden;
    }

    .product-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(46, 204, 113, 0.05), transparent);
        animation: productShimmer 6s ease-in-out infinite;
        z-index: 1;
    }

    @keyframes productShimmer {
        0%, 100% { left: -100%; }
        50% { left: 100%; }
    }

    /* Enhanced Product Gallery */
    .product-gallery { 
        text-align: center;
        position: relative;
        z-index: 2;
    }

    .main-image-container {
        position: relative;
        margin-bottom: 20px;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--shadow-medium);
    }

    .main-image { 
        width: 100%; 
        height: 500px; 
        object-fit: cover; 
        background-color: var(--surface-light);
        transition: all 0.3s ease;
        border-radius: 20px;
    }

    .main-image:hover {
        transform: scale(1.02);
    }

    /* Image Navigation */
    .image-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2em;
        transition: all 0.3s ease;
        z-index: 3;
    }

    .image-nav:hover {
        background: var(--primary-color);
        transform: translateY(-50%) scale(1.1);
    }

    .image-nav.prev {
        left: 20px;
    }

    .image-nav.next {
        right: 20px;
    }

    /* Thumbnail Gallery */
    .thumbnail-images { 
        display: flex; 
        justify-content: center; 
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .thumbnail { 
        width: 100px; 
        height: 100px; 
        object-fit: cover; 
        border-radius: 15px; 
        cursor: pointer; 
        border: 3px solid var(--border-color);
        opacity: 0.7;
        transition: all 0.3s ease;
        position: relative;
    }

    .thumbnail:hover {
        opacity: 1;
        transform: scale(1.05);
        border-color: var(--primary-color);
    }
    
    .thumbnail.active { 
        border-color: var(--primary-color); 
        opacity: 1;
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(46, 204, 113, 0.3);
    }

    /* Enhanced Product Details */
    .product-details {
        position: relative;
        z-index: 2;
    }

    .product-details h1 { 
        margin-top: 0; 
        font-size: 2.5em;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        line-height: 1.2;
    }

    .product-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background: var(--surface-light);
        border-radius: 25px;
        color: var(--text-secondary);
        font-size: 0.9em;
    }

    .meta-item i {
        color: var(--primary-color);
    }

    .product-price { 
        font-size: 3em; 
        color: var(--primary-color); 
        font-weight: 800; 
        margin: 30px 0;
        text-shadow: 0 2px 10px rgba(46, 204, 113, 0.3);
    }

    .product-description { 
        line-height: 1.8;
        font-size: 1.1em;
        color: var(--text-primary);
        margin-bottom: 40px;
    }

    .product-description h4 {
        font-size: 1.3em;
        color: var(--primary-color);
        margin-bottom: 15px;
        font-weight: 600;
    }

    /* Enhanced Action Buttons */
    .action-buttons {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 40px;
    }

    .add-to-cart-btn, .wishlist-btn {
        padding: 18px 35px;
        border-radius: 15px;
        font-size: 1.2em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
    }

    .add-to-cart-btn {
        background: var(--gradient-primary);
        color: white;
        flex: 1;
        min-width: 200px;
    }

    .add-to-cart-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(46, 204, 113, 0.4);
    }

    .wishlist-btn {
        background: transparent;
        color: var(--text-primary);
        border: 2px solid var(--border-color);
        padding: 16px 25px;
    }

    .wishlist-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        transform: translateY(-3px);
    }

    /* Product Features */
    .product-features {
        margin-top: 50px;
        padding: 30px;
        background: var(--surface-light);
        border-radius: 20px;
        border: 1px solid var(--border-color);
    }

    .features-title {
        font-size: 1.5em;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        background: var(--surface-dark);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .feature-item:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
    }

    .feature-item i {
        color: var(--primary-color);
        font-size: 1.2em;
    }

    .feature-item span {
        color: var(--text-secondary);
        font-size: 0.9em;
    }

    /* Seller Information */
    .seller-info {
        margin-top: 40px;
        padding: 25px;
        background: var(--surface-light);
        border-radius: 15px;
        border: 1px solid var(--border-color);
    }

    .seller-title {
        font-size: 1.2em;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .seller-name {
        color: var(--primary-color);
        font-weight: 500;
    }

    /* Image Modal */
    .image-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 10000;
        justify-content: center;
        align-items: center;
    }

    .image-modal.active {
        display: flex;
    }

    .modal-content {
        max-width: 90%;
        max-height: 90%;
        position: relative;
    }

    .modal-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 10px;
    }

    .modal-close {
        position: absolute;
        top: -50px;
        right: 0;
        background: var(--primary-color);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2em;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .product-container {
            grid-template-columns: 1fr;
            gap: 40px;
            padding: 40px;
        }

        .main-image {
            height: 400px;
        }
    }

    @media (max-width: 768px) {
        .product-container {
            padding: 30px 20px;
            margin: 20px;
        }

        .product-details h1 {
            font-size: 2em;
        }

        .product-price {
            font-size: 2.5em;
        }

        .action-buttons {
            flex-direction: column;
        }

        .add-to-cart-btn, .wishlist-btn {
            width: 100%;
            justify-content: center;
        }

        .main-image {
            height: 300px;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
        }

        .features-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .product-container {
            padding: 20px 15px;
            margin: 15px;
        }

        .product-details h1 {
            font-size: 1.8em;
        }

        .product-price {
            font-size: 2em;
        }

        .main-image {
            height: 250px;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
        }

        .image-nav {
            width: 40px;
            height: 40px;
            font-size: 1em;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="product-container" data-aos="fade-up">
    <div class="product-gallery">
        <div class="main-image-container">
        <img src="{{ url_for('static', filename='images/' + product.image_list[0]) }}" id="mainImage" class="main-image" alt="Main product image">
            
            {% if product.image_list|length > 1 %}
                <button class="image-nav prev" onclick="previousImage()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="image-nav next" onclick="nextImage()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            {% endif %}
        </div>
        
        {% if product.image_list|length > 1 %}
        <div class="thumbnail-images">
            {% for image_name in product.image_list %}
            <img src="{{ url_for('static', filename='images/' + image_name) }}" 
                 class="thumbnail {% if loop.first %}active{% endif %}" 
                 data-image-src="{{ url_for('static', filename='images/' + image_name) }}" 
                 onclick="changeImage(this, this.dataset.imageSrc)"
                 onmouseenter="previewImage(this.dataset.imageSrc)">
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="product-details">
        <h1>{{ product.name }}</h1>
        
        <div class="product-meta">
            <div class="meta-item">
                <i class="fas fa-tag"></i>
                <span>{{ product.category }}</span>
            </div>
            <div class="meta-item">
                <i class="fas fa-user"></i>
                <span>Sold by {{ product.first_name }}</span>
            </div>
            {% if product.condition %}
            <div class="meta-item">
                <i class="fas fa-star"></i>
                <span>{{ product.condition }}</span>
            </div>
            {% endif %}
        </div>
        
        <div class="product-price">${{ "%.2f"|format(product.market_price) }}</div>
        
        <div class="product-description">
            <h4><i class="fas fa-info-circle"></i> Description</h4>
            <p>{{ product.description }}</p>
        </div>
        
        <div class="action-buttons">
        <button class="add-to-cart-btn" onclick="addToCart()">
            <i class="fas fa-cart-plus"></i> Add to Cart
        </button>
            <button class="wishlist-btn" onclick="toggleWishlist()">
                <i class="fas fa-heart"></i> Wishlist
            </button>
        </div>

        <!-- Product Features -->
        <div class="product-features">
            <h3 class="features-title">
                <i class="fas fa-list"></i>
                Product Details
            </h3>
            <div class="features-grid">
                {% if product.brand %}
                <div class="feature-item">
                    <i class="fas fa-tag"></i>
                    <span><strong>Brand:</strong> {{ product.brand }}</span>
                </div>
                {% endif %}
                {% if product.model %}
                <div class="feature-item">
                    <i class="fas fa-cube"></i>
                    <span><strong>Model:</strong> {{ product.model }}</span>
                </div>
                {% endif %}
                {% if product.year_of_manufacture %}
                <div class="feature-item">
                    <i class="fas fa-calendar"></i>
                    <span><strong>Year:</strong> {{ product.year_of_manufacture }}</span>
                </div>
                {% endif %}
                {% if product.material %}
                <div class="feature-item">
                    <i class="fas fa-layer-group"></i>
                    <span><strong>Material:</strong> {{ product.material }}</span>
                </div>
                {% endif %}
                {% if product.color %}
                <div class="feature-item">
                    <i class="fas fa-palette"></i>
                    <span><strong>Color:</strong> {{ product.color }}</span>
                </div>
                {% endif %}
                {% if product.dimensions %}
                <div class="feature-item">
                    <i class="fas fa-ruler"></i>
                    <span><strong>Dimensions:</strong> {{ product.dimensions }}</span>
                </div>
                {% endif %}
                {% if product.weight %}
                <div class="feature-item">
                    <i class="fas fa-weight"></i>
                    <span><strong>Weight:</strong> {{ product.weight }}</span>
                </div>
                {% endif %}
                {% if product.has_original_packaging %}
                <div class="feature-item">
                    <i class="fas fa-box"></i>
                    <span><strong>Original Packaging:</strong> Yes</span>
                </div>
                {% endif %}
                {% if product.has_manual %}
                <div class="feature-item">
                    <i class="fas fa-book"></i>
                    <span><strong>Manual:</strong> Included</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Seller Information -->
        <div class="seller-info">
            <h3 class="seller-title">
                <i class="fas fa-user-circle"></i>
                Seller Information
            </h3>
            <p>This item is being sold by <span class="seller-name">{{ product.first_name }}</span>, a trusted member of our EcoFinds community.</p>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div class="image-modal" id="imageModal">
    <div class="modal-content">
        <img class="modal-image" id="modalImage" src="" alt="Product Image">
        <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="application/json" id="product-data">
{
    "images": {{ product.image_list | tojson | safe }},
    "productId": {{ product.id | tojson | safe }},
    "sellerId": {{ product.seller_id | tojson | safe }}
}
</script>
<script>
    // Get product data from JSON script tag
    const productData = JSON.parse(document.getElementById('product-data').textContent);
    
    let currentImageIndex = 0;
    const images = productData.images;
    
    function changeImage(thumbnailElement, newImageSrc) {
        // Update main image with smooth transition
        const mainImage = document.getElementById('mainImage');
        mainImage.style.opacity = '0';
        
        setTimeout(() => {
            mainImage.src = newImageSrc;
            mainImage.style.opacity = '1';
        }, 150);
        
        // Update active thumbnail
        document.querySelectorAll('.thumbnail').forEach(thumb => thumb.classList.remove('active'));
        thumbnailElement.classList.add('active');
        
        // Update current index
        currentImageIndex = Array.from(document.querySelectorAll('.thumbnail')).indexOf(thumbnailElement);
    }

    function nextImage() {
        if (currentImageIndex < images.length - 1) {
            currentImageIndex++;
        } else {
            currentImageIndex = 0;
        }
        const thumbnail = document.querySelectorAll('.thumbnail')[currentImageIndex];
        changeImage(thumbnail, thumbnail.dataset.imageSrc);
    }

    function previousImage() {
        if (currentImageIndex > 0) {
            currentImageIndex--;
        } else {
            currentImageIndex = images.length - 1;
        }
        const thumbnail = document.querySelectorAll('.thumbnail')[currentImageIndex];
        changeImage(thumbnail, thumbnail.dataset.imageSrc);
    }

    function previewImage(imageSrc) {
        // Add hover preview effect
        const mainImage = document.getElementById('mainImage');
        mainImage.style.transform = 'scale(1.05)';
        mainImage.style.filter = 'brightness(1.1)';
    }

    function addToCart() {
        const button = document.querySelector('.add-to-cart-btn');
        const originalText = button.innerHTML;
        
        // Add loading state
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        button.disabled = true;
        
        fetch('/add_to_cart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ product_id: productData.productId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showNotification(data.error, 'error');
            } else {
                showNotification(data.message, 'success');
                // Update cart count in navbar
                updateCartCount();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Failed to add product to cart', 'error');
        })
        .finally(() => {
            button.innerHTML = originalText;
            button.disabled = false;
        });
    }

    function toggleWishlist() {
        const button = document.querySelector('.wishlist-btn');
        const icon = button.querySelector('i');
        
        if (icon.classList.contains('fas')) {
            icon.classList.remove('fas');
            icon.classList.add('far');
            showNotification('Removed from wishlist', 'info');
        } else {
            icon.classList.remove('far');
            icon.classList.add('fas');
            showNotification('Added to wishlist', 'success');
        }
    }

    function showNotification(message, type) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type}`;
        notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
        
        // Add to page
        document.querySelector('.content').insertBefore(notification, document.querySelector('.product-container'));
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function updateCartCount() {
        // This would typically fetch the updated cart count from the server
        // For now, we'll simulate it
        const cartCountElement = document.querySelector('.cart-count');
        if (cartCountElement) {
            const currentCount = parseInt(cartCountElement.textContent) || 0;
            cartCountElement.textContent = currentCount + 1;
        }
    }

    function closeModal() {
        document.getElementById('imageModal').classList.remove('active');
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
            previousImage();
        } else if (e.key === 'ArrowRight') {
            nextImage();
        } else if (e.key === 'Escape') {
            closeModal();
        }
    });

    // Click on main image to open modal
    document.getElementById('mainImage').addEventListener('click', function() {
        const modal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        modalImage.src = this.src;
        modal.classList.add('active');
    });

    // Add smooth scroll behavior
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Add intersection observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all feature items
    document.querySelectorAll('.feature-item').forEach(item => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = 'all 0.6s ease';
        observer.observe(item);
    });
</script>
{% endblock %}

